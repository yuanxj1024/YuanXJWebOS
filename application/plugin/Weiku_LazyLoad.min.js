/* Õº∆¨¿¡º”‘ÿ */
var LazyLoad=function(options){    
	this.SetOptions(options);
	this.container=$(this.options.container);
	this.childs=$(this.options.container).find("[lazyload-src]");	
	this.data=[];	
	this.oldScroll=this.options.oldScroll;
	this.newScroll=this.options.newScroll;
	this.ImgWidth=this.options.ImgWidth;
	this.ImgHeight=this.options.ImgHeight;
	this.isZoom=this.options.isZoom;
	this.Initialize();
	this.ScrollLoad();
	this.ResizeLoad();	
};
LazyLoad.prototype={
	SetOptions:function(options){
		this.options={
			container:null,
			childs:null,
			oldScroll:0,
			newScroll:0,
			isZoom:false,
			ImgWidth:60,
			ImgHeight:60
		};		
		$.extend(this.options,options||{});
	},
	Initialize:function(){
		if(this.isZoom){
			this.CreateImage()}
		this.Mheight=this.container.height()+this.container.offset().top;
		for(var i=0;i<this.childs.length;i++){
			this.data.push($(this.childs[i]).offset().top);
		}
		this.RunLoad()
	},
	CreateImage:function(){
		this.image=[],this.image_src=[];
		for(var i=0;i<this.childs.length;i++){
			this.image_src.push($(this.childs[i]).attr("lazyload-src"));
			this.image.push(new Image());		
		}
	},
	LoadImage:function(i){
		var _this=this;
		(function(){
			var index=i;
			$(_this.image[index]).load(function(){
				if(_this.image[index].width==0||_this.image[index].height==0)return;
				_this.AutoScaling(_this.image[index],index);
				_this.image[index]=new Image()
			});
			_this.image[index].src=_this.image_src[index]})()		
	},
	AutoScaling:function(source,index){
		var childsImg=this.childs;
		if(source.width>0&&source.height>0){
			if(source.width/source.height>=this.ImgWidth/this.ImgHeight){
				if(source.width>this.ImgWidth){
					$(childsImg[index]).width(this.ImgWidth);
					$(childsImg[index]).height((source.height*this.ImgWidth)/source.width)
				}else{
					$(childsImg[index]).width(source.width);
					$(childsImg[index]).height(source.height)}
				}else{
					if(source.height>this.ImgHeight){
						$(childsImg[index]).height(this.ImgHeight);
						$(childsImg[index]).width((source.width*this.ImgHeight)/source.height)
					}else{
						$(childsImg[index]).width(source.width);
						$(childsImg[index]).height(source.height);
					}
				}		
		}
		source=new Image();
	},
	Before:function(){
		var _Cheight;
		_Cheight=$(window).height()+$(window).scrollTop();
		return _Cheight;
	},
	Compare:function(iHeight){
		var Cheight;
		Cheight=this.Before();
		return Cheight-iHeight;
	},
	RunLoad:function(){
		var compareValue,_this=this;
		this.oldScroll=$(window).scrollTop();
		for(var i=0;i<this.data.length;i++){
			compareValue=this.Compare(this.data[i]);			
			if(compareValue>-0&&!!$(this.childs[i]).attr("lazyload-src")){  
				$(this.childs[i]).removeAttr("lazyload-src");
				$(this.childs[i]).attr("src",_this.image_src[i]);								
				if(this.isZoom)
				  this.LoadImage(i);
				$(this.childs[i]).hide().fadeIn(300);
			}
		}
	},
	ScrollLoad:function(){
		var _this=this;
		$(window).bind("scroll."+_this.options.container,function(){
			_this.newScroll=$(window).scrollTop();
			_this.StopLoad();
			if(_this.newScroll-_this.oldScroll<0){return ;}
			_this.RunLoad();
		})
	},
	ResizeLoad:function(){
		var _this=this;$(window).bind("resize."+_this.options.container,function(){_this.RunLoad();});
	},
	StopLoad:function (){
		var Cheight;
		Cheight=this.Before();
		if(Cheight>this.Mheight){
			$(window).unbind("scroll."+this.options.container);
			$(window).unbind("resize."+this.options.container);
		}
	}};
	
	